ratingsNew.push({
    'filters' : [
        {
            'name'      : 'type',
            'position'  : 'left',
            'values'    : [
                {
                    'value'     : 'WoS',
                    'label'     : 'Web of Science',
                    'active'    : true
                },

                {
                    'value'     : 'Scopus',
                    'label'     : 'Scopus'
                }
            ]
        },

        {
            'name'      : 'year',
            'position'  : 'left',
            'values'    : [
                {
                    'value'     : '2017',
                    'label'     : '2017'
                },

                {
                    'value'     : '2018',
                    'label'     : '2018',
                    'active'    : true
                }
            ]
        },

        {
            'name'      : 'sort',
            'position'  : 'bottom',
            'nofilter'  : true,
            'values'    : [
                {
                    'value'     : 'value',
                    'label'     : 'число статей',
                    'active'    : true
                },

                {
                    'value'     : 'value100',
                    'label'     : 'число статей на 100 исследователей'
                }
            ]
        }
    ],

    'data' : [
        {
            'type'      : 'WoS',
            'year'      : '2017',
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '23426',
                    'value100'  : '12,7'
                },

                {
                    'district'  : '2',
                    'value'     : '8226',
                    'value100'  : '17,0'
                },

                {
                    'district'  : '3',
                    'value'     : '1323',
                    'value100'  : '9,7'
                },

                {
                    'district'  : '4',
                    'value'     : '717',
                    'value100'  : '15,9'
                },

                {
                    'district'  : '5',
                    'value'     : '6896',
                    'value100'  : '13,1'
                },

                {
                    'district'  : '6',
                    'value'     : '3376',
                    'value100'  : '14,9'
                },

                {
                    'district'  : '7',
                    'value'     : '8056',
                    'value100'  : '31,4'
                },

                {
                    'district'  : '8',
                    'value'     : '1837',
                    'value100'  : '24,7'
                }
            ]
        },

        {
            'type'      : 'WoS',
            'year'      : '2018',
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '25249',
                    'value100'  : '17.4'
                },

                {
                    'district'  : '2',
                    'value'     : '8505',
                    'value100'  : '19.3'
                },

                {
                    'district'  : '3',
                    'value'     : '1583',
                    'value100'  : '13.6'
                },

                {
                    'district'  : '4',
                    'value'     : '802',
                    'value100'  : '19.2'
                },

                {
                    'district'  : '5',
                    'value'     : '7092',
                    'value100'  : '13.9'
                },

                {
                    'district'  : '6',
                    'value'     : '3620',
                    'value100'  : '17.2'
                },

                {
                    'district'  : '7',
                    'value'     : '8298',
                    'value100'  : '37.8'
                },
                {
                    'district'  : '8',
                    'value'     : '2060',
                    'value100'  : '29.3'
                }
            ]
        },

        {
            'type'      : 'WoS',
            'year'      : '2019',
            'predict'   : true,
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '30514'
                },

                {
                    'district'  : '2',
                    'value'     : '10278'
                },

                {
                    'district'  : '3',
                    'value'     : '1913'
                },

                {
                    'district'  : '4',
                    'value'     : '969'
                },

                {
                    'district'  : '5',
                    'value'     : '8571'
                },

                {
                    'district'  : '6',
                    'value'     : '4375'
                },

                {
                    'district'  : '7',
                    'value'     : '10028'
                },

                {
                    'district'  : '8',
                    'value'     : '2490'
                }
            ]
        },

        {
            'type'      : 'WoS',
            'year'      : '2020',
            'predict'   : true,
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '34836'
                },

                {
                    'district'  : '2',
                    'value'     : '11734'
                },

                {
                    'district'  : '3',
                    'value'     : '2184'
                },

                {
                    'district'  : '4',
                    'value'     : '1107'
                },

                {
                    'district'  : '5',
                    'value'     : '9785'
                },

                {
                    'district'  : '6',
                    'value'     : '4995'
                },

                {
                    'district'  : '7',
                    'value'     : '11449'
                },

                {
                    'district'  : '8',
                    'value'     : '2842'
                }
            ]
        },

        {
            'type'      : 'WoS',
            'year'      : '2021',
            'predict'   : true,
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '39771'
                },

                {
                    'district'  : '2',
                    'value'     : '13397'
                },

                {
                    'district'  : '3',
                    'value'     : '2493'
                },

                {
                    'district'  : '4',
                    'value'     : '1263'
                },

                {
                    'district'  : '5',
                    'value'     : '11171'
                },

                {
                    'district'  : '6',
                    'value'     : '5702'
                },

                {
                    'district'  : '7',
                    'value'     : '13071'
                },

                {
                    'district'  : '8',
                    'value'     : '3245'
                }
            ]
        },

        {
            'type'      : 'WoS',
            'year'      : '2022',
            'predict'   : true,
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '45405'
                },

                {
                    'district'  : '2',
                    'value'     : '15295'
                },

                {
                    'district'  : '3',
                    'value'     : '2847'
                },

                {
                    'district'  : '4',
                    'value'     : '1442'
                },

                {
                    'district'  : '5',
                    'value'     : '12754'
                },

                {
                    'district'  : '6',
                    'value'     : '6510'
                },

                {
                    'district'  : '7',
                    'value'     : '14922'
                },

                {
                    'district'  : '8',
                    'value'     : '3705'
                }
            ]
        },

        {
            'type'      : 'WoS',
            'year'      : '2023',
            'predict'   : true,
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '51838'
                },

                {
                    'district'  : '2',
                    'value'     : '17461'
                },

                {
                    'district'  : '3',
                    'value'     : '3250'
                },

                {
                    'district'  : '4',
                    'value'     : '1647'
                },

                {
                    'district'  : '5',
                    'value'     : '14560'
                },

                {
                    'district'  : '6',
                    'value'     : '7432'
                },

                {
                    'district'  : '7',
                    'value'     : '17036'
                },

                {
                    'district'  : '8',
                    'value'     : '4229'
                }
            ]
        },

        {
            'type'      : 'Scopus',
            'year'      : '2017',
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '29002',
                    'value100'  : '15,7'
                },

                {
                    'district'  : '2',
                    'value'     : '8642',
                    'value100'  : '17,9'
                },

                {
                    'district'  : '3',
                    'value'     : '1903',
                    'value100'  : '13,9'
                },

                {
                    'district'  : '4',
                    'value'     : '739',
                    'value100'  : '16,4'
                },

                {
                    'district'  : '5',
                    'value'     : '6785',
                    'value100'  : '12,9'
                },

                {
                    'district'  : '6',
                    'value'     : '2918',
                    'value100'  : '12,8'
                },

                {
                    'district'  : '7',
                    'value'     : '8523',
                    'value100'  : '33,2'
                },

                {
                    'district'  : '8',
                    'value'     : '1906',
                    'value100'  : '25,6'
                }
            ]
        },

        {
            'type'      : 'Scopus',
            'year'      : '2018',
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '31731',
                    'value100'  : '18.1'
                },

                {
                    'district'  : '2',
                    'value'     : '9325',
                    'value100'  : '20.0'
                },

                {
                    'district'  : '3',
                    'value'     : '2250',
                    'value100'  : '16.5'
                },

                {
                    'district'  : '4',
                    'value'     : '864',
                    'value100'  : '20.1'
                },

                {
                    'district'  : '5',
                    'value'     : '7427',
                    'value100'  : '13.9'
                },

                {
                    'district'  : '6',
                    'value'     : '3297',
                    'value100'  : '14.9'
                },

                {
                    'district'  : '7',
                    'value'     : '9051',
                    'value100'  : '35.6'
                },

                {
                    'district'  : '8',
                    'value'     : '2105',
                    'value100'  : '28.7'
                }
            ]
        },

        {
            'type'      : 'Scopus',
            'year'      : '2019',
            'predict'   : true,
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '35172'
                },

                {
                    'district'  : '2',
                    'value'     : '10336'
                },

                {
                    'district'  : '3',
                    'value'     : '2494'
                },

                {
                    'district'  : '4',
                    'value'     : '958'
                },

                {
                    'district'  : '5',
                    'value'     : '8232'
                },

                {
                    'district'  : '6',
                    'value'     : '3655'
                },

                {
                    'district'  : '7',
                    'value'     : '10032'
                },

                {
                    'district'  : '8',
                    'value'     : '2333'
                }
            ]
        },

        {
            'type'      : 'Scopus',
            'year'      : '2020',
            'predict'   : true,
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '38965'
                },

                {
                    'district'  : '2',
                    'value'     : '11451'
                },

                {
                    'district'  : '3',
                    'value'     : '2763'
                },

                {
                    'district'  : '4',
                    'value'     : '1061'
                },

                {
                    'district'  : '5',
                    'value'     : '9120'
                },

                {
                    'district'  : '6',
                    'value'     : '4049'
                },

                {
                    'district'  : '7',
                    'value'     : '11114'
                },

                {
                    'district'  : '8',
                    'value'     : '2585'
                }
            ]
        },

        {
            'type'      : 'Scopus',
            'year'      : '2021',
            'predict'   : true,
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '43168'
                },

                {
                    'district'  : '2',
                    'value'     : '12686'
                },

                {
                    'district'  : '3',
                    'value'     : '3061'
                },

                {
                    'district'  : '4',
                    'value'     : '1175'
                },

                {
                    'district'  : '5',
                    'value'     : '10104'
                },

                {
                    'district'  : '6',
                    'value'     : '4485'
                },

                {
                    'district'  : '7',
                    'value'     : '12313'
                },

                {
                    'district'  : '8',
                    'value'     : '2864'
                }
            ]
        },

        {
            'type'      : 'Scopus',
            'year'      : '2022',
            'predict'   : true,
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '47823'
                },

                {
                    'district'  : '2',
                    'value'     : '14054'
                },

                {
                    'district'  : '3',
                    'value'     : '3391'
                },

                {
                    'district'  : '4',
                    'value'     : '1302'
                },

                {
                    'district'  : '5',
                    'value'     : '11194'
                },

                {
                    'district'  : '6',
                    'value'     : '4969'
                },

                {
                    'district'  : '7',
                    'value'     : '13641'
                },

                {
                    'district'  : '8',
                    'value'     : '3173'
                }
            ]
        },

        {
            'type'      : 'Scopus',
            'year'      : '2023',
            'predict'   : true,
            'data'      : [
                {
                    'district'  : '1',
                    'value'     : '52981'
                },

                {
                    'district'  : '2',
                    'value'     : '15570'
                },

                {
                    'district'  : '3',
                    'value'     : '3757'
                },

                {
                    'district'  : '4',
                    'value'     : '1443'
                },

                {
                    'district'  : '5',
                    'value'     : '12401'
                },

                {
                    'district'  : '6',
                    'value'     : '5505'
                },

                {
                    'district'  : '7',
                    'value'     : '15112'
                },

                {
                    'district'  : '8',
                    'value'     : '3515'
                }
            ]
        }
    ],

    'update' : function(cubeFace, curData) {
        var mapColors = [
            ['#91d9d0', '#7cbabd', '#6398a8', '#4f7b96'],
            ['#95f5c7', '#7cd6ab', '#5aac85', '#398461']
        ];

        var mapColorsDistrictsValueWoS = [
            [0, 1000],
            [1000, 5000],
            [5000, 10000],
            [10000, Infinity]
        ];

        var mapColorsDistrictsValue100WoS = [
            [0, 20],
            [20, 30],
            [30, 40],
            [40, Infinity]
        ];

        var mapColorsDistrictsValueScopus = [
            [0, 3000],
            [3000, 7000],
            [7000, 15000],
            [15000, Infinity]
        ];

        var mapColorsDistrictsValue100Scopus = [
            [0, 15],
            [15, 20],
            [20, 30],
            [30, Infinity]
        ];

        var mapColorsRegions = [
            {
                'id'        : 1,
                'WoS'       : {
                    'value'     : [
                        [0, 100],
                        [100, 350],
                        [350, 600],
                        [600, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 20],
                        [20, 50],
                        [50, Infinity]
                    ]
                },
                'Scopus'    : {
                    'value'     : [
                        [0, 100],
                        [100, 250],
                        [250, 500],
                        [500, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 20],
                        [20, 50],
                        [50, Infinity]
                    ]
                }
            },

            {
                'id'        : 2,
                'WoS'       : {
                    'value'     : [
                        [0, 50],
                        [50, 250],
                        [250, 500],
                        [500, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 30],
                        [30, 50],
                        [50, Infinity]
                    ]
                },
                'Scopus'    : {
                    'value'     : [
                        [0, 50],
                        [50, 200],
                        [200, 350],
                        [350, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 30],
                        [30, 50],
                        [50, Infinity]
                    ]
                }
            },

            {
                'id'        : 3,
                'WoS'       : {
                    'value'     : [
                        [0, 50],
                        [50, 250],
                        [250, 500],
                        [500, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 20],
                        [20, 30],
                        [30, Infinity]
                    ]
                },
                'Scopus'    : {
                    'value'     : [
                        [0, 50],
                        [50, 250],
                        [250, 500],
                        [500, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 20],
                        [20, 30],
                        [30, Infinity]
                    ]
                }
            },

            {
                'id'        : 4,
                'WoS'       : {
                    'value'     : [
                        [0, 50],
                        [50, 100],
                        [100, 200],
                        [200, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 20],
                        [20, 30],
                        [30, Infinity]
                    ]
                },
                'Scopus'    : {
                    'value'     : [
                        [0, 100],
                        [100, 150],
                        [150, 200],
                        [200, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 20],
                        [20, 30],
                        [30, Infinity]
                    ]
                }
            },

            {
                'id'        : 5,
                'WoS'       : {
                    'value'     : [
                        [0, 100],
                        [100, 500],
                        [500, 1000],
                        [1000, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 20],
                        [20, 30],
                        [30, Infinity]
                    ]
                },
                'Scopus'    : {
                    'value'     : [
                        [0, 100],
                        [100, 500],
                        [500, 1000],
                        [1000, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 30],
                        [30, 50],
                        [50, Infinity]
                    ]
                }
            },

            {
                'id'        : 6,
                'WoS'       : {
                    'value'     : [
                        [0, 50],
                        [50, 500],
                        [500, 1000],
                        [1000, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 20],
                        [20, 30],
                        [30, Infinity]
                    ]
                },
                'Scopus'    : {
                    'value'     : [
                        [0, 50],
                        [50, 500],
                        [500, 1000],
                        [1000, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 20],
                        [20, 30],
                        [30, Infinity]
                    ]
                }
            },

            {
                'id'        : 7,
                'WoS'       : {
                    'value'     : [
                        [0, 50],
                        [50, 500],
                        [500, 1000],
                        [1000, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 30],
                        [30, 50],
                        [50, Infinity]
                    ]
                },
                'Scopus'    : {
                    'value'     : [
                        [0, 50],
                        [50, 500],
                        [500, 1000],
                        [1000, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 30],
                        [30, 50],
                        [50, Infinity]
                    ]
                }
            },

            {
                'id'        : 8,
                'WoS'       : {
                    'value'     : [
                        [0, 50],
                        [50, 100],
                        [100, 500],
                        [500, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 30],
                        [30, 50],
                        [50, Infinity]
                    ]
                },
                'Scopus'    : {
                    'value'     : [
                        [0, 50],
                        [50, 100],
                        [100, 500],
                        [500, Infinity]
                    ],
                    'value100'  : [
                        [0, 10],
                        [10, 30],
                        [30, 50],
                        [50, Infinity]
                    ]
                }
            }
        ];

        function faceSortCount(a, b) {
            var value1 = parseInt(a.value.replace(/ /g, ''));
            var value2 = parseInt(b.value.replace(/ /g, ''));
            if (value1 > value2) return -1;
            if (value1 == value2) return 0;
            if (value1 < value2) return 1;
        }

        function faceSortCount100(a, b) {
            var value1 = parseFloat(a.value100.replace(/ /g, '').replace(/,/g, '.'));
            var value2 = parseFloat(b.value100.replace(/ /g, '').replace(/,/g, '.'));
            if (value1 > value2) return -1;
            if (value1 == value2) return 0;
            if (value1 < value2) return 1;
        }

        var curType = cubeFace.find('.rating-new-filter[data-name="type"]').find('li.active').attr('data-value');
        var curSort = cubeFace.find('.rating-new-filter[data-name="sort"]').find('li.active').attr('data-value');

        var activeValue = ' active';
        var activeValue100 = '';
        cubeFace.find('.ratings-new-map-table-head').eq(1).addClass('active');
        cubeFace.find('.ratings-new-map-table-head').eq(2).removeClass('active');

        if (curSort == 'value') {
            curData.sort(faceSortCount);
        } else {
            curData.sort(faceSortCount100);
            var activeValue = '';
            var activeValue100 = ' active';
            cubeFace.find('.ratings-new-map-table-head').eq(2).addClass('active');
            cubeFace.find('.ratings-new-map-table-head').eq(1).removeClass('active');
        }
        var newMap = '';
        cubeFace.find('.ratings-new-map-table-row').remove();

        var curRatingsArray = [];
        if (curType == 'WoS') {
            if (curSort == 'value') {
                curRatingsArray = mapColorsDistrictsValueWoS;
            } else {
                curRatingsArray = mapColorsDistrictsValue100WoS;
            }
        } else {
            if (curSort == 'value') {
                curRatingsArray = mapColorsDistrictsValueScopus;
            } else {
                curRatingsArray = mapColorsDistrictsValue100Scopus;
            }
        }

        var legendHTML = '';
        if (curType == 'WoS') {
            var legendColors = mapColors[0];
        } else {
            var legendColors = mapColors[1];
        }
        for (var ra = 0; ra < curRatingsArray.length; ra++) {
            var legendText = '';
            if (curRatingsArray[ra][0] == 0) {
                legendText = 'до ' + String(curRatingsArray[ra][1]).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g, '$1 ');
            } else if (curRatingsArray[ra][1] == Infinity) {
                legendText = 'более ' + String(curRatingsArray[ra][0]).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g, '$1 ');
            } else {
                legendText = 'от ' + String(curRatingsArray[ra][0]).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g, '$1 ') + ' до ' + String(curRatingsArray[ra][1]).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g, '$1 ');
            }
            legendHTML += '<div class="ratings-new-map-russia-legend-item"><div class="ratings-new-map-russia-legend-item-color" style="background:' + legendColors[ra] + '"></div>' + legendText + '</div>';
        }

        cubeFace.find('.ratings-new-map-russia-legend').html(legendHTML);

        for (var i = 0; i < curData.length; i++) {
            var districtID = curData[i].district;
            var districtTitle = '';
            for (var r = 0; r < russiaDistricts.length; r++) {
                if (russiaDistricts[r].id == districtID) {
                    districtTitle = russiaDistricts[r].title;
                }
            }

            var curColorIndex = -1;
            var curValue = parseInt(curData[i].value.replace(/ /g, ''));
            if (curSort == 'value100') {
                curValue = parseFloat(curData[i].value100.replace(/ /g, '').replace(/,/g, '.'));
            }
            for (var c = 0; c < curRatingsArray.length; c++) {
                if (curValue >= curRatingsArray[c][0] && curValue < curRatingsArray[c][1]) {
                    curColorIndex = c;
                }
            }

            if (curType == 'WoS') {
                var curColor = mapColors[0][curColorIndex];
            } else {
                var curColor = mapColors[1][curColorIndex];
            }

            newMap += '<g class="ratings-new-map-russia-district" data-id="' + districtID + '" data-title="' + districtTitle + '">';
            for (var j = 0; j < russiaRegions.length; j++) {
                var curRegion = russiaRegions[j];
                if (curRegion.district == districtID) {
                    newMap += '<g style="fill:' + curColor + '">' + curRegion.svg + '</g>';
                }
            }
            newMap += '</g>';
            var districtTitle = '';
            for (var j = 0; j < russiaDistricts.length; j++) {
                if (russiaDistricts[j].id == districtID) {
                    districtTitle = russiaDistricts[j].title;
                }
            }
            cubeFace.find('.ratings-new-map-table').append('<div class="ratings-new-map-table-row">' +
                                        '<div class="ratings-new-map-table-name">' +
                                            '<a href="#" class="ratings-new-map-table-name-link" data-id="' + districtID + '">' +
                                                '<div class="ratings-new-map-table-name-color" style="background:' + curColor + '"></div>' +
                                                '<div class="ratings-new-map-table-name-text">' + districtTitle + '</div>' +
                                            '</a>' +
                                        '</div>' +
                                        '<div class="ratings-new-map-table-value' + activeValue + '">' + String(curData[i].value).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g, '$1 ') + '</div>' +
                                        '<div class="ratings-new-map-table-value' + activeValue100 + '">' + String(curData[i].value100).replace(/\./g, ',') + '</div>' +
                                      '</div>');
        }
        cubeFace.find('.ratings-new-map-russia svg').html(newMap);
    }
});